<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Fshow/Votação</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

 <link rel="icon" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png" type="image/png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="icon" type="image/png" sizes="192x192" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">

  <link rel="apple-touch-icon" sizes="57x57" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">

  <link rel="icon" type="image/png" sizes="192x192" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="icon" type="image/png" sizes="512x512" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">

  <meta name="theme-color" content="#8A2BE2">
  <meta name="msapplication-TileColor" content="#FF8C00">
  <meta name="msapplication-TileImage" content="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">

  <link rel="icon" type="image/png" sizes="192x192" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="icon" type="image/png" sizes="512x512" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <link rel="mask-icon" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png" color="#ff8c00">
  <link rel="manifest" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <meta name="msapplication-TileColor" content="#ff8c00">
  <meta name="msapplication-TileImage" content="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png">
  <meta name="theme-color" content="#8a2be2">

  <style>
    /* ===== VARIÁVEIS GLOBAIS ===== */
    :root {
      --bg: #121212;
      --card-bg: #2b2b2b;
      --accent: #00b7b0;
      --text: #fff;
      --muted: #bdbdbd;
      --border-radius: 8px;
      --transition: all 0.3s ease;
      --shadow-md: 0 4px 14px rgba(0, 0, 0, 0.4);
      --panel-border: rgba(255, 255, 255, 0.06);
    }

    /* ===== BASE ===== */
    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: "Inter", Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 10% 20%, rgba(0, 183, 176, 0.32), transparent 55%),
        radial-gradient(circle at 85% 75%, rgba(0, 110, 255, 0.28), transparent 60%),
        radial-gradient(circle at 50% -20%, rgba(200, 0, 255, 0.25), transparent 70%),
        linear-gradient(145deg, #0a0b0d, #101218 45%, #060708);
      background-attachment: fixed;
      background-size: cover;
      min-height: 100vh;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px 15px;
      animation: slideUp 0.6s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 { font-size: 20px; font-weight: 700; margin-bottom: 10px; text-align: left; }
    h2 { font-size: 14px; color: var(--muted); margin-bottom: 20px; font-weight: 400; }

    /* ===== OPÇÕES ===== */
    .options { display: flex; flex-direction: column; gap: 12px; }

    .option {
      display: flex;
      background: var(--card-bg);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--border-radius);
      overflow: hidden;
      cursor: pointer;
      transition: var(--transition);
    }

    .option:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
      border-color: var(--accent);
    }

    .option img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .option-content {
      display: flex;
      align-items: center;
      padding: 0 15px;
      width: 100%;
      font-size: 18px;
      font-weight: 500;
    }

    .option-content input[type="radio"] {
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--muted);
      border-radius: 50%;
      margin-right: 10px;
      cursor: pointer;
      position: relative;
    }

    .option-content input[type="radio"]:checked { border-color: var(--accent); }
    .option-content input[type="radio"]:checked::before {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: 50%;
      background: var(--accent);
    }

    /* ===== HCAPTCHA & BUTTON ===== */
    .captcha-container {
      margin: 20px 0;
      display: flex;
      justify-content: center;
    }

    button#botaoVotar {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      background: #444;
      color: var(--muted);
      transition: var(--transition);
    }

    button#botaoVotar.active {
      background: var(--accent);
      color: #fff;
    }

    button#botaoVotar:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .notice { font-size: 12px; color: var(--muted); text-align: center; margin-top: 15px; }

    /* ===== TELA DE SUCESSO ===== */
    #confirmTela {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      min-height: 80vh;
      text-align: center;
    }

    .confirm-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--panel-border);
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      width: 100%;
    }

    .confirm-card img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    #nomeConfirm { font-size: 24px; font-weight: 700; margin: 10px 0; }
    .success-msg { color: #00ff99; font-weight: 600; margin: 15px 0; }

    .voltar {
      background: var(--accent);
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
    }

    /* DESKTOP */
    @media (min-width: 1024px) {
      .container { max-width: 900px; }
      .options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }
      .option { flex-direction: column; }
      .option img { width: 100%; height: 200px; }
      .option-content { padding: 15px; background: #1f1f1f; }
    }
  </style>

  <!-- SDKs -->
  <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <div id="votoTela" class="container">
    <h1>Quem você quer que ENTRE na F10?</h1>
    <h2>Apenas um voto por pessoa</h2>
    
    <div class="options">
      <label class="option">
        <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Ella.jpg?raw=true" alt="Ella">
        <div class="option-content">
          <input type="radio" name="vote" value="Ella"> Ella
        </div>
      </label>

      <label class="option">
        <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Eueu.jpg?raw=true" alt="Eueu">
        <div class="option-content">
          <input type="radio" name="vote" value="Eueu"> Eueu
        </div>
      </label>

      <label class="option">
        <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Koyuh.jpg?raw=true" alt="Koyuh">
        <div class="option-content">
          <input type="radio" name="vote" value="Koyuh"> Koyuh
        </div>
      </label>

      <label class="option">
        <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Luca.jpg?raw=true" alt="Luca">
        <div class="option-content">
          <input type="radio" name="vote" value="Luca"> Luca
        </div>
      </label>
    </div>

    <div class="captcha-container">
      <!-- Substitua data-sitekey pela sua chave do hCaptcha -->
      <div class="h-captcha" data-sitekey="6dfe175a-b5e8-4474-ac38-a84436a8004c" data-callback="onCaptchaSuccess" data-theme="dark"></div>
    </div>

    <button id="botaoVotar" disabled>Votar</button>
    <div class="notice">A votação segue aberta até às 18:00</div>
  </div>

  <div id="confirmTela">
    <div class="confirm-card">
      <img id="fotoConfirm" src="" alt="Voto"/>
      <p id="nomeConfirm"></p>
      <div class="success-msg">✔ Voto computado com sucesso!</div>
      <button class="voltar" onclick="location.reload()">VOTAR NOVAMENTE</button>
    </div>
  </div>

  <script>
    /* ======================================================
       CONFIGURAÇÃO CENTRAL
    ====================================================== */
    const ROUND_ID = "rodada_00"; 

    const SUPABASE_URL = "https://beuqcarjvvjjmwoedvsc.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJldXFjYXJqdnZqam13b2VkdnNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MzUxODQsImV4cCI6MjA4NDQxMTE4NH0.RxFRnk7zqPCJcIcF99BdPYLPRFtMR99diu4lU9pENJ4";
    const TABLE_NAME = "paiolf10u";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    /* ======================================================
       ESTADO E ELEMENTOS
    ====================================================== */
    const botaoVotar = document.getElementById("botaoVotar");
    const votoTela = document.getElementById("votoTela");
    const confirmTela = document.getElementById("confirmTela");
    const nomeConfirm = document.getElementById("nomeConfirm");
    const fotoConfirm = document.getElementById("fotoConfirm");
    
    let captchaToken = null;
    let userIP = null;

  const fotos = {
    "Caio": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Caio.jpg?raw=true",
    "Cícero": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Cícero.jpg?raw=true",
    "Duck": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Duck.jpg?raw=true",
    "Ella": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Ella.jpg?raw=true",
    "Eueu": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Eueu.jpg?raw=true",
    "Fernanda": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Fernanda.jpg?raw=true",
    "João": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/João.jpg?raw=true",
    "Kelvin": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Kelvin.jpg?raw=true",
    "Koyuh": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Koyuh.jpg?raw=true",
    "Luca": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Luca.jpg?raw=true",
    "Lucas": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Lucas.jpg?raw=true",
    "Luddy": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Luddy.jpg?raw=true",
    "Ludmila": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Ludmila.jpg?raw=true",
    "Mari": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Mari.jpg?raw=true",
    "Mariana": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Mariana.jpg?raw=true",
    "Mikael": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Mikael.jpg?raw=true",
    "Mira": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Mira.jpg?raw=true",
    "Nick": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Nick.jpg?raw=true",
    "Paiva": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Paiva.jpg?raw=true",
    "Renata": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Renata.jpg?raw=true",
    "Rose": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Rose.jpg?raw=true",
    "Vitor": "https://github.com/VulgoFshow/New-Fshow/blob/main/fotos/Vitor.jpg?raw=true"
  };


    /* ======================================================
       FUNÇÕES
    ====================================================== */
    async function getIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip;
      } catch (e) { return null; }
    }

    // Callback do hCaptcha
    window.onCaptchaSuccess = function(token) {
      captchaToken = token;
      checkReady();
    };

    // Verifica se pode habilitar o botão
    function checkReady() {
      const selecionado = document.querySelector('input[name="vote"]:checked');
      if (selecionado && captchaToken) {
        botaoVotar.disabled = false;
        botaoVotar.classList.add("active");
      } else {
        botaoVotar.disabled = true;
        botaoVotar.classList.remove("active");
      }
    }

    // Escuta mudanças nos radios
    document.querySelectorAll('input[name="vote"]').forEach(radio => {
      radio.addEventListener('change', checkReady);
    });

    async function submitVote() {
      const selecionado = document.querySelector('input[name="vote"]:checked');
      if (!selecionado || !captchaToken) return;

      botaoVotar.disabled = true;
      botaoVotar.innerText = "Processando...";

      try {
        userIP = await getIP();

        // 1. Verificar se já votou NESTA RODADA (LocalStorage)
        if (localStorage.getItem("voted_fshow_round") === ROUND_ID) {
          window.location.href = "javotou.html";
          return;
        }

        // 2. Enviar para Supabase (Incluindo o round_id)
        const { error } = await supabaseClient
          .from(TABLE_NAME)
          .insert([{ 
            participante: selecionado.value, 
            ip: userIP,
            round_id: ROUND_ID,
            hcaptcha_token: captchaToken
          }]);

        if (error) {
          // Se o erro for de unicidade (IP + ROUND_ID), significa que já votou
          if (error.code === '23505') { 
            alert("Este IP já registrou um voto nesta rodada!");
            localStorage.setItem("voted_fshow_round", ROUND_ID);
          } else {
            throw error;
          }
          location.reload();
          return;
        }

        // 3. Sucesso
        localStorage.setItem("voted_fshow_round", ROUND_ID);
        votoTela.style.display = "none";
        confirmTela.style.display = "flex";
        nomeConfirm.textContent = selecionado.value;
        fotoConfirm.src = fotos[selecionado.value] || "";

      } catch (e) {
        console.error(e);
        alert("Erro ao votar. Tente novamente.");
        botaoVotar.disabled = false;
        botaoVotar.innerText = "Votar";
      }
    }

    botaoVotar.onclick = submitVote;

    // Verificação inicial
    (async function init() {
      if (localStorage.getItem("voted_fshow_round") === ROUND_ID) {
        // Opcional: Bloquear interface se já votou na rodada atual
      }
    })();
  </script>
</body>
</html>
