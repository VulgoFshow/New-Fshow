<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Fshow/Votação</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>

    :root {
      --bg: #121212;
      --card-bg: #2b2b2b;
      --selected-bg: #3c3c3c;
      --border-radius: 8px;
      --accent: #00b7b0;
      --text: #fff;
      --muted: #bdbdbd;
      --panel-bg: #2b2b2b;
      --panel-border: rgba(255,255,255,0.06);
      
    }body {
  background: transparent !important; /* fundo totalmente transparente */
  font-family: Arial, sans-serif;
  color: var(--text);
  margin: 0;
  padding: 0;
}

.container {
  max-width: 400px;
  margin: 0 auto;
  padding: 20px 15px;
}

color:var(--text);margin:0;padding:0}

    h1{font-size:20px;font-weight:700;margin-bottom:20px;text-align:left}
    .option{display:flex;align-items:stretch;background:var(--card-bg);border-radius:var(--border-radius);margin-bottom:12px;overflow:hidden;border:1px solid #fff;cursor:pointer;transition:.2s}
    .option img{width:150px;height:auto;object-fit:cover;flex-shrink:0}
    .option-content{display:flex;align-items:center;padding:0 12px;width:100%;font-size:18px;font-weight:500;position:relative}
    .option-content input[type="radio"]{appearance:none;-webkit-appearance:none;width:20px;height:20px;border:2px solid var(--muted);border-radius:50%;margin-right:8px;cursor:pointer;position:relative}
    .option-content input[type="radio"]:checked{border-color:var(--accent)}
    .option-content input[type="radio"]:checked::before{content:"";position:absolute;width:10px;height:10px;top:3px;left:3px;border-radius:50%;background:var(--accent)}
    button{width:100%;padding:14px;font-size:16px;border:none;border-radius:var(--border-radius);margin-top:15px;cursor:pointer;background:#444;color:var(--muted);font-weight:bold;transition:.3s}
    button.active{background:var(--accent);color:#fff}
    button:disabled{opacity:.6;cursor:not-allowed}
    .notice{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}

    /* popup & confirmação (mantidos) */
    .popup{display:none;position:fixed;z-index:1500;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.85);align-items:center;justify-content:center;padding:20px;overflow-y:auto}
    .popup.active{display:flex}
    .captcha-box{background:#222;padding:20px 30px;border-radius:10px;width:340px;max-width:100%;text-align:center;color:#eee}
    .captcha-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:15px}
    .captcha-img{width:100%;aspect-ratio:1/1;object-fit:cover;border:2px solid transparent;cursor:pointer;border-radius:6px}
    .captcha-img.selected{border-color:#00aaff;box-shadow:0 0 8px #00aaffcc}
    .captcha-footer{display:flex;gap:10px;justify-content:center}
    .captcha-btn{background:#00aaff;color:#111;border:none;padding:9px 18px;font-size:15px;font-weight:600;border-radius:6px;cursor:pointer;flex:1;max-width:140px}
    .captcha-btn:disabled{background:#004466;cursor:not-allowed}
    #fotoConfirm{width:100%;border-radius:10px;margin-bottom:12px;border:1px solid #fff}
    #nomeConfirm{background:#222;color:#fff;font-size:18px;font-weight:700;padding:10px;border-radius:6px;margin-bottom:18px;border:1px solid #fff}
    .success-msg{display:flex;align-items:center;justify-content:center;font-size:14px;color:#fff;background:rgba(0,255,100,.15);border:1px solid rgba(0,255,100,.4);border-radius:6px;padding:10px;margin-bottom:18px}
    .success-msg::before{content:"✔";color:#00ff6a;margin-right:6px}
    .voltar{background:var(--accent);color:#fff}

    /* tela de confirmação transparente */
#confirmTela {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  text-align: center;
  background: transparent !important;
  min-height: 85vh;
}

.confirm-card {
  background: transparent !important; 
  border: 1px solid var(--panel-border);
  border-radius: 12px;
  padding: 20px;
  max-width: 380px;
  width: 100%;
}
    #botaoCaptcha {
      display: flex;               
      align-items: center;         
      justify-content: flex-start; 
      background: #222;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 0 15px;
      cursor: pointer;
      user-select: none;
      height: 70px;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.6);
      transition: border-color 0.3s, box-shadow 0.3s;
      color: #ccc;
      font-size: 14px;
      font-weight: 400;
      margin: 20px auto 0;       
      max-width: 320px;          
      width: 320px;              
      gap: 12px;
    }

    .recaptcha-checkbox {
      flex-shrink: 0;
      width: 30px;
      height: 30px;
      background: #111;
      border: 2px solid #444;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #botaoCaptcha[aria-pressed="true"] .recaptcha-checkbox {
      background-color: #00aaff;
      border-color: #00aaff;
    }

    .checkmark {
      width: 18px;
      height: 18px;
      display: none;
      stroke: white;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    #botaoCaptcha[aria-pressed="true"] .checkmark {
      display: block;
    }

    .recaptcha-label {
      user-select: none;
      line-height: 1;
      flex-grow: 1;              
    }

    .recaptcha-icon {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: contain;
      filter: brightness(0.7);
      flex-shrink: 0;
    }
    
    #botaoCaptcha:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  pointer-events: none; 
}

  </style>
</head>
<body>
  <div id="votoTela" class="container">
    <h1>Quem deve ser ELIMINADO?</h1>

    <label class="option">
      <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bflavia.jpg?raw=true" alt="Flávia">
      <div class="option-content">
        <input type="radio" name="vote" value="Flávia"> Flávia
      </div>
    </label>
    
<label class="option">
      <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bines.jpg?raw=true" alt="Inês">
      <div class="option-content">
        <input type="radio" name="vote" value="Inês"> Inês
      </div>
    </label>
    
    <label class="option">
      <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bneto.jpg?raw=true" alt="Neto">
      <div class="option-content">
        <input type="radio" name="vote" value="Neto"> Neto
      </div>
    </label>
  

    <button id="botaoCaptcha" aria-pressed="false" type="button" aria-label="Não sou um robô">
      <span class="recaptcha-checkbox" aria-hidden="true">
        <svg class="checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M4 12l6 6 10-10"/></svg>
      </span>
      <span class="recaptcha-label">Não sou um robô</span>
      <img class="recaptcha-icon" src="https://i.imgur.com/orZDpuE.png" alt="Logo personalizada" style="width:40px;height:40px;border-radius:4px"/>
    </button>

    <button id="botaoVotar" disabled>Votar</button>

    <div class="notice">São válidos apenas os votos feitos em território nacional.</div>
  </div>

  <script async="async" data-cfasync="false" src="//pl27399086.revenuecpmgate.com/1faff871cdf0e9772e4c2ca3e13e0bee/invoke.js"></script>
<div id="container-1faff871cdf0e9772e4c2ca3e13e0bee"></div>

  <div id="popupCaptcha" class="popup">
    <div class="captcha-box">
      <h3 id="captcha-instruction">Carregando desafio...</h3>
      <div id="captcha-grid" class="captcha-grid"></div>
      <div class="captcha-footer">
        <button id="refresh-btn" class="captcha-btn">↻ Novo</button>
        <button id="verify-btn" class="captcha-btn" disabled>Verificar</button>
      </div>
      <div id="captcha-status" class="captcha-status"></div>
    </div>
  </div>

  <div id="confirmTela">
    <div class="confirm-card">
      <img id="fotoConfirm" src="" alt="Foto do participante"/>
      <p id="nomeConfirm"></p>
      <div class="success-msg">Voto computado com sucesso!</div>
      <button class="voltar" onclick="window.location.href='https://fshow.site/vot2.html'">
  VOTAR NOVAMENTE
</button>
      <div class="notice">São válidos apenas os votos feitos em território nacional.</div>
      <script async="async" data-cfasync="false" src="//pl27399086.revenuecpmgate.com/1faff871cdf0e9772e4c2ca3e13e0bee/invoke.js"></script>
<div id="container-1faff871cdf0e9772e4c2ca3e13e0bee"></div>
    </div>
  </div>
  
<script>
// ===== CONTROLE DE ENCERRAMENTO =====

// (ano, mês, dia, hora, minuto)
const encerramento = new Date(2025, 8, 28, 11, 0, 0);


const votacaoAtiva = true;

function checkEncerramento() {
  const agora = new Date();

  if (!votacaoAtiva || agora >= encerramento) {
    window.location.href = "fechada.html";
  }
}

checkEncerramento();

setInterval(checkEncerramento, 60 * 1000);
</script>
<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js';

const supabase = createClient(
  'https://vchvvvvzulrkovjmiokg.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjaHZ2dnZ6dWxya292am1pb2tnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NzYwMDIsImV4cCI6MjA3NDA1MjAwMn0.vHgI_JDNKDECR8H1wVC3LwGeMux8gAKkoeCmPSPuSA4'
);

// ===== CONFIG =====
const VOTOS_POR_CAPTCHA = 5;

function getVotosRestantes() {
  return parseInt(localStorage.getItem("votosRestantes") ?? "0", 10);
}
function setVotosRestantes(n) {
  localStorage.setItem("votosRestantes", String(n));
}

// ===== ELEMENTOS =====
const votoTela = document.getElementById("votoTela");
const confirmTela = document.getElementById("confirmTela");
const nomeConfirm = document.getElementById("nomeConfirm");
const fotoConfirm = document.getElementById("fotoConfirm");

const botaoCaptcha = document.getElementById("botaoCaptcha");
const botaoVotar = document.getElementById("botaoVotar");

const popupCaptcha = document.getElementById("popupCaptcha");
const captchaGrid = document.getElementById("captcha-grid");
const captchaInstruction = document.getElementById("captcha-instruction");
const verifyBtn = document.getElementById("verify-btn");
const refreshBtn = document.getElementById("refresh-btn");
const statusEl = document.getElementById("captcha-status");

// === prompts do CAPTCHA ===
const prompts = [
  {
    label: "Clique nas imagens contendo algo que pode se locomover",
    correctTag: "transporte",
    images: [
      { src: "https://http2.mlstatic.com/D_815735-MLB80705886004_112024-C.jpg", tag: "transporte" },
      { src: "https://www.revistapro.com.br/uploads/images/2024/01/image_750x_65b99d3786b02.jpg", tag: "transporte" },
      { src: "https://cdn.motor1.com/images/mgl/g4JY94/419:0:1080:1080/avelloz-az-125-2024---registro-no-brasil.webp", tag: "transporte" },
      { src: "https://www.fiat.com.br/content/dam/fiat/nova-home/carrossel/argo.webp", tag: "transporte" },
      { src: "https://www.moneytimes.com.br/uploads/2022/01/fiat-pulse-67.jpg", tag: "transporte" },
      { src: "https://correiodeuberlandia.com.br/wp-content/uploads/2024/09/20240921-dia-da-arvore.jpg", tag: "outros" },
      { src: "https://www.housedigest.com/img/gallery/these-are-the-places-in-the-u-s-where-neem-trees-can-thrive/where-to-plant-neem-trees-1711104953.jpg", tag: "outros" },
      { src: "https://hotelbalneariopc.com.br/gdd/sgc/imagens/foto_texto/26/rad91AB2201810211663_457.jpg", tag: "outroa" },
      { src: "https://123ecos.com.br/wp-content/uploads/2024/11/Parque-Estadual-da-Pedra-Azul-1-1.jpg", tag: "outro" },
      { src: "https://thumbs.dreamstime.com/b/rocha-ou-pedra-grande-na-montanha-118007979.jpg", tag: "outro" }
    ]
  },
  {
    label: "Clique nas imagens contendo um quadrúpede",
    correctTag: "animal",
    images: [
      { src: "https://img.cancaonova.com/cnimages/canais/uploads/sites/6/2021/08/formacao_a-expressao-%E2%80%9Cbode-expiatorio%E2%80%9D-possui-origem-na-biblia.jpg", tag: "animal" },
      { src: "https://picinspire.com/uploads/media/default/0001/27/thumb_26625_default_med.jpg", tag: "animal" },
      { src: "https://www.shutterstock.com/image-photo/adorable-happy-white-dog-isolated-600nw-2574597113.jpg", tag: "animal" },
      { src: "https://www.shutterstock.com/image-photo/cute-dog-tongue-out-isolated-600nw-2510143377.jpg", tag: "animal" },
      { src: "https://i.redd.it/ml0omhvjlrxb1.jpg", tag: "animal" },
      { src: "https://moinhoglobo.com.br/wp-content/uploads/2020/10/05-sorvete-caseiro.jpg", tag: "outros" },
      { src: "https://www.tecsoft.ind.br/wp-content/uploads/2023/12/cascao-sorvete-soft-2-sabores-alto-lucro-investimento.webp", tag: "outros" },
      { src: "https://www.oitedi.com.br/_next/image?url=https%3A%2F%2Ftedi-production.s3.amazonaws.com%2Fcooking_recipes%2Ffood_description%2F18622aa1308c719b20da5b9e2e97f9b0cd7dfe85.png&w=1080&q=70", tag: "outros" },
      { src: "https://www.oitedi.com.br/_next/image?url=https%3A%2F%2Ftedi-production.s3.amazonaws.com%2Fcooking_recipes%2Ffood_description%2F0ee09a7cdb27ec074ef259c03d40e3a2d7dec07e.png&w=1080&q=70", tag: "outro" }
    ]
  }
];

// ===== UTIL =====
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}


let pendingVote = null;

function generateCaptcha() {
  captchaGrid.innerHTML = "";
  statusEl.textContent = "";
  verifyBtn.disabled = true;

  const prompt = prompts[Math.floor(Math.random() * prompts.length)];
  const correctImages = prompt.images.filter(img => img.tag === prompt.correctTag);
  const wrongImages = prompt.images.filter(img => img.tag !== prompt.correctTag);

  const correctCount = Math.floor(Math.random() * 3) + 2; // 2..4 corretas
  const selectedCorrect = shuffle(correctImages).slice(0, correctCount);
  const selectedWrong = shuffle(wrongImages).slice(0, 9 - correctCount);

  const allImages = shuffle([...selectedCorrect, ...selectedWrong]);

  captchaInstruction.textContent = prompt.label;

  allImages.forEach(img => {
    const imgEl = document.createElement("img");
    imgEl.src = img.src;
    imgEl.className = "captcha-img";
    imgEl.dataset.correct = img.tag === prompt.correctTag ? "true" : "false";
    imgEl.addEventListener("click", () => {
      imgEl.classList.toggle("selected");
      verifyBtn.disabled = !document.querySelector(".captcha-img.selected");
      statusEl.textContent = "";
    });
    captchaGrid.appendChild(imgEl);
  });
}

function abrirCaptcha() {
  generateCaptcha();
  popupCaptcha.classList.add("active");
  botaoCaptcha.setAttribute("aria-pressed", "false");
  botaoVotar.disabled = true; // evita cliques enquanto resolve
  statusEl.textContent = "";
}

function fecharCaptcha() {
  popupCaptcha.classList.remove("active");
  botaoVotar.disabled = false;
}

verifyBtn.addEventListener("click", () => {
  let sucesso = true;
  const imgs = document.querySelectorAll(".captcha-img");
  imgs.forEach(img => {
    const correto = img.dataset.correct === "true";
    const selecionado = img.classList.contains("selected");
    if (correto !== selecionado) sucesso = false;
  });

  if (sucesso) {
    statusEl.textContent = "✅ Você passou no CAPTCHA!";
    statusEl.style.color = "#00aaff";

    // libera X votos e marca o botão como "checado"
    setVotosRestantes(VOTOS_POR_CAPTCHA);
    botaoCaptcha.setAttribute("aria-pressed", "true");
    botaoVotar.disabled = false;
    botaoVotar.classList.add("active");

    // fecha popup
    setTimeout(() => {
      fecharCaptcha();

      // se havia um voto pendente (usuário clicou em Votar e abriu captcha), submete automaticamente
      if (pendingVote) {
        const voto = pendingVote;
        pendingVote = null;
        // pequena espera para UX (fecha o modal e mostra "Enviando...")
        setTimeout(() => {
          submitVote(voto);
        }, 200);
      }
    }, 500);
  } else {
    statusEl.textContent = "❌ Tente novamente.";
    statusEl.style.color = "#ff5555";
    setTimeout(() => generateCaptcha(), 1500);
  }
});

// ===== FUNÇÃO QUE REALMENTE ENVIA O VOTO (faz insert no supabase) =====
async function submitVote(participante) {
  try {
    botaoVotar.disabled = true;
    const prevText = botaoVotar.textContent;
    botaoVotar.textContent = "Enviando...";

    // MUDAR TABLE AQUI 
    const { data, error } = await supabase
      .from("paredão9")
      .insert({ participante });

    if (error) {
      console.error("Supabase error:", error);
      alert("❌ Erro ao registrar voto: " + error.message);
      botaoVotar.disabled = false;
      botaoVotar.textContent = prevText;
      return;
    }

    // decrementa votos restantes
    let restantes = getVotosRestantes() - 1;
    if (restantes <= 0) {
      setVotosRestantes(0);
      botaoCaptcha.setAttribute("aria-pressed", "false"); // precisa captcha no próximo
      botaoVotar.classList.remove("active");
    } else {
      setVotosRestantes(restantes);
    }

    // mostra confirmação
    votoTela.style.display = "none";
    confirmTela.style.display = "flex";
    nomeConfirm.textContent = participante;
    fotoConfirm.src = {
      "Koyuh": "https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bkoyuh.jpg?raw=true",
      "Mikael": "https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bmikael.jpg?raw=true",
      "Tety": "https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/btety.jpg?raw=true"
    }[participante] || "";

    botaoVotar.textContent = prevText;
    botaoVotar.disabled = false;
    console.log("Voto registrado:", data);
  } catch (err) {
    console.error("Erro submitVote:", err);
    alert("Erro inesperado. Veja o console do navegador.");
    botaoVotar.disabled = false;
    botaoVotar.textContent = "Votar";
  }
}

// ===== LÓGICA DO BOTÃO "VOTAR" (gatilho) =====
botaoVotar.addEventListener("click", (e) => {
  e.preventDefault();
  const escolhidoEl = document.querySelector('input[name="vote"]:checked');
  if (!escolhidoEl) {
    alert("Selecione um participante antes de votar!");
    return;
  }
  const participante = escolhidoEl.value;

  // Se não há votos livres, abre captcha e guarda voto pendente
  if (getVotosRestantes() <= 0) {
    pendingVote = participante;
    abrirCaptcha();
    return;
  }

  // caso contrário, submete imediatamente
  submitVote(participante);
});

// ===== BOTÃO DE CAPTCHA =====
botaoCaptcha.addEventListener("click", () => {
  if (botaoCaptcha.getAttribute("aria-pressed") === "true") return;

  if (getVotosRestantes() > 0) {
    // Ainda tem votos livres -> só de clicar libera
    botaoCaptcha.setAttribute("aria-pressed", "true");
    botaoVotar.disabled = false;
    botaoVotar.classList.add("active");
  } else {
    // Sem votos livres -> precisa resolver captcha
    abrirCaptcha();
  }
});

// ===== INIT (sincroniza estado inicial) =====
(function initState() {
  const restantes = getVotosRestantes();

  // Sempre começa "desmarcado"
  botaoCaptcha.setAttribute("aria-pressed", "false");
  botaoCaptcha.disabled = false;

  // Botão de votar sempre começa bloqueado
  botaoVotar.disabled = true;
  botaoVotar.classList.remove("active");

  // Mantém os votos restantes armazenados, mas só libera quando clicar no captcha
  if (restantes > 0) {
    setVotosRestantes(restantes); // mantém contador
  } else {
    setVotosRestantes(0);
  }
})();

</script>

</body>
</html>
