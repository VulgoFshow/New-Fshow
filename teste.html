<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Voice Brasil - Votação</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>

    <div class="container">
        <section id="step-votação" class="step active">
            <div class="hero-card">
                <span class="badge">Votação</span>
                <h1>Escolha seu candidato</h1>
                <p>Você pode votar em um candidato por vez. Vote várias vezes.</p>
            </div>

            <div class="candidate-list" id="candidate-list">
                </div>
        </section>

        <section id="step-confirmacao" class="step">
              <div class="hero-card">
              <span class="badge">Votação</span>
              <h1>Candidato selecionado.</h1>
              <p>Passe pelo catcha para confirmar o seu voto</p>
            </div>
            <h2>Confirme seu voto</h2>
            <div id="selected-candidate-card"></div>
            
            <div class="captcha-container">
                <div class="g-recaptcha" data-sitekey="6Lev1DUsAAAAANzB2nhPDsKVzXZP0daxuDMCil1a" data-callback="onCaptchaSuccess" data-theme="dark"></div>
            </div>

            <button class="btn-back" onclick="changeStep('votação')">
                <span class="icon">↺</span> Alterar voto
            </button>
        </section>

<section id="step-sucesso" class="step">
    <div class="success-card">
        <div class="success-icon">✓</div>
        <h2>Voto computado com sucesso!</h2>
        <button class="btn-again" onclick="resetVotacao()">Votar novamente</button>
    </div>
</section>

        <footer>
            <p>Essa enquete <strong>não tem</strong> efeito na votação principal</p>
            <button class="btn-logout">Sair</button>
        </footer>
    </div>

</body>
</html>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Roboto, Arial, sans-serif;
}

html {
    scroll-behavior: smooth;
}

body {
    background: radial-gradient(circle at top, #1a1a1a 0%, #000 65%);
    color: #fff;
}

.container {
    max-width: 430px;
    margin: 0 auto;
    padding: 16px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* ===== STEPS ===== */
.step {
    display: none;
    opacity: 0;
    transform: translateY(20px);
    animation: stepIn .45s ease forwards;
}

.step.active {
    display: block;
}

@keyframes stepIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== HEADER ===== */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 0;
}

.logo {
    height: 34px;
}

.menu-icon span {
    display: block;
    width: 22px;
    height: 2px;
    background: #fff;
    margin: 4px 0;
    opacity: .9;
}

/* ===== HERO ===== */
.hero-card {
    position: relative;
    border-radius: 20px;
    padding: 22px;
    margin-bottom: 22px;
    overflow: hidden;
    background-image:
        linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.85)),
        url("https://i.ibb.co/h14c6kWP/Chat-GPT-Image-24-de-dez-de-2025-12-57-49.png");
    background-size: cover;
    background-position: center;
    animation: fadeUp .6s ease;
}

/* Gradientes coloridos por cima da imagem */
.hero-card::after {
    content: "";
    position: absolute;
    inset: 0;
    background:
        radial-gradient(circle at top right, rgba(255,0,80,.45), transparent 60%),
        radial-gradient(circle at bottom left, rgba(120,0,255,.45), transparent 60%);
    pointer-events: none;
}

/* Conteúdo acima da imagem */
.hero-card * {
    position: relative;
    z-index: 1;
}


@keyframes fadeUp {
    from {
        opacity: 0;
        transform: translateY(18px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.badge {
    display: inline-block;
    border: 1px solid rgba(255,255,255,.3);
    padding: 4px 14px;
    border-radius: 30px;
    font-size: 11px;
    text-transform: uppercase;
    opacity: .85;
}

.hero-card h1 {
    font-size: 24px;
    margin-top: 14px;
    font-weight: 600;
}

.hero-card p {
    margin-top: 6px;
    font-size: 14px;
    color: #cfcfcf;
}

/* ===== CANDIDATOS ===== */
.candidate-card {
    display: flex;
    align-items: center;
    background: #1c1f26;
    margin-bottom: 12px;
    border-radius: 16px;
    padding: 12px;
    cursor: pointer;
    border: 1px solid rgba(255,255,255,.05);
    transition: all .25s ease;
    animation: fadeUp .4s ease;
}

.candidate-card:hover {
    background: #262a38;
    transform: scale(1.02);
}

.candidate-card:active {
    transform: scale(.98);
}

.candidate-card img {
    width: 64px;
    height: 64px;
    border-radius: 12px;
    object-fit: cover;
    margin-right: 14px;
}

.candidate-info h3 {
    font-size: 16px;
}

.candidate-info p {
    font-size: 13px;
    color: #b5b5b5;
}

/* ===== CONFIRMAÇÃO ===== */
#step-confirmacao h2 {
    margin-bottom: 16px;
}

#selected-candidate-card .candidate-card {
    background: #242834;
    cursor: default;
}

/* ===== CAPTCHA ===== */

.captcha-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
    padding: 24px;
    background: rgba(0,0,0,.55);
    border-radius: 22px;
    backdrop-filter: blur(12px);
}

/* ===== BOTÕES ===== */
button {
    background: linear-gradient(135deg, #ff005d, #6a00ff);
    border: none;
    color: #fff;
    padding: 14px;
    border-radius: 30px;
    font-size: 15px;
    cursor: pointer;
    transition: transform .2s ease, box-shadow .2s ease;
    box-shadow: 0 8px 20px rgba(0,0,0,.35);
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(0,0,0,.5);
}

button:active {
    transform: scale(.97);
}

.btn-back {
    background: transparent;
    border: 1px solid rgba(255,255,255,.25);
    margin-top: 10px;
}

/* ===== SUCESSO ===== */
#step-sucesso {
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 140px);
}

#step-sucesso.active {
    display: flex;
}


.success-card {
    width: 100%;
    max-width: 360px;
    background:
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.85)),
        url("https://i.ibb.co/h14c6kWP/Chat-GPT-Image-24-de-dez-de-2025-12-57-49.png");
    background-size: cover;
    background-position: center;
    border-radius: 26px;
    padding: 36px 24px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,.6);
    animation: fadeUp .6s ease;
}

.success-icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border: 3px solid #5CFF7A;
    color: #5CFF7A;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    margin: 0 auto 18px;
}

.success-card h2 {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 26px;
}

.btn-again {
    background: #fff;
    color: #000;
    border-radius: 999px;
    padding: 14px 26px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: transform .2s ease;
}

.btn-again:hover {
    transform: scale(1.04);
}

@keyframes pulse {
    0% { box-shadow: 0 0 20px rgba(46,204,113,.5); }
    50% { box-shadow: 0 0 45px rgba(46,204,113,.9); }
    100% { box-shadow: 0 0 20px rgba(46,204,113,.5); }
}

/* ===== FOOTER ===== */
footer {
    margin-top: auto;
    text-align: center;
    padding: 26px 0;
    font-size: 13px;
    color: #9a9a9a;
}

footer strong {
    color: #fff;
}

.btn-logout {
    background: none;
    border: none;
    color: #9a9a9a;
    text-decoration: underline;
    cursor: pointer;
}

</style>

<script>
const _supabase = window.supabase.createClient(
  'https://rvizztgogtepktmnfdhc.supabase.co',
  'sb_publishable_5vd5eUluXqj2Wq0xTaWwdA_QUpGP9kP'
);


const candidatos = [
    { id: 1, nome: 'Bell Éter', time: 'Time Duda', foto: 'https://i.ibb.co/G3ppwjkj/Gean.jpg' },
    { id: 2, nome: 'Jamah', time: 'Time Péricles', foto: 'https://i.ibb.co/XZmgWgL1/Felipe.jpg' },
    { id: 3, nome: 'Thiago Garcia', time: 'Time Mumu', foto: 'https://i.ibb.co/YBP4Hs44/Neto.jpg' },
    { id: 4, nome: 'Jade Salles', time: 'Time M&K', foto: 'https://i.ibb.co/KxdRJJ8h/Sam.jpg' }
];

let candidatoSelecionado = null;

// Renderizar candidatos
function renderCandidates() {
    const list = document.getElementById('candidate-list');
    list.innerHTML = candidatos.map(c => `
        <div class="candidate-card" onclick="selectCandidate(${c.id})">
            <img src="${c.foto}" alt="${c.nome}">
            <div class="candidate-info">
                <h3>${c.nome}</h3>
                <p>${c.time}</p>
            </div>
        </div>
    `).join('');
}

function selectCandidate(id) {
    candidatoSelecionado = candidatos.find(c => c.id === id);
    document.getElementById('selected-candidate-card').innerHTML = `
        <div class="candidate-card">
            <img src="${candidatoSelecionado.foto}">
            <div class="candidate-info">
                <h3>${candidatoSelecionado.nome}</h3>
                <p>${candidatoSelecionado.time}</p>
            </div>
        </div>
    `;
    changeStep('confirmacao');
}

function changeStep(stepId) {
    const steps = document.querySelectorAll('.step');
    steps.forEach(s => {
        s.classList.remove('active');
    });

    const target = document.getElementById(`step-${stepId}`);
    target.classList.add('active');
    target.scrollIntoView({ behavior: 'smooth' });
}

// Callback do Captcha (executa quando o usuário clica no "Não sou um robô")
async function onCaptchaSuccess() {
    if (!candidatoSelecionado) return;

    // Enviar para o Supabase
    const { data, error } = await _supabase
        .from('votos')
        .insert([{ candidato_id: candidatoSelecionado.id }]);

    if (error) {
        alert("Erro ao votar: " + error.message);
    } else {
        changeStep('sucesso');
    }
}

function resetVotacao() {
    candidatoSelecionado = null;
    grecaptcha.reset(); // Reseta o captcha para novo voto
    changeStep('votação');
}

// Inicializar
renderCandidates();
</script>
