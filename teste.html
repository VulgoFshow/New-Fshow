<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Sims - Vota√ß√£o</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Roboto, Arial, sans-serif;
}

html {
    scroll-behavior: smooth;
}

body {
    background: radial-gradient(circle at top, #1a1a1a 0%, #000 65%);
    color: #fff;
}

.container {
    max-width: 430px;
    margin: 0 auto;
    padding: 16px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;

    border: 2px solid rgba(255,255,255,.25);
    border-radius: 24px;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
}



/* ===== STEPS ===== */
.step {
    display: none;
    opacity: 0;
    transform: translateY(20px);
    animation: stepIn .45s ease forwards;
}

.step.active {
    display: block;
}

@keyframes stepIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== HEADER ===== */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 0;
}

.logo {
    height: 34px;
}

.menu-icon span {
    display: block;
    width: 22px;
    height: 2px;
    background: #fff;
    margin: 4px 0;
    opacity: .9;
}

/* ===== HERO ===== */
.hero-card {
    position: relative;
    padding: 22px;
    margin: -16px -16px 22px -16px;
    overflow: hidden;

    border-radius: 0;

    background-image:
        linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.85)),
        url("https://i.ibb.co/8gvrdhDw/colorsplash.png");
    background-size: cover;
    background-position: center;
}

/* Gradientes coloridos por cima da imagem */
.hero-card::after {
    content: "";
    position: absolute;
    inset: 0;
    background:
        radial-gradient(circle at top right, rgba(255,0,80,.45), transparent 60%),
        radial-gradient(circle at bottom left, rgba(120,0,255,.45), transparent 60%);
    pointer-events: none;
}

/* Conte√∫do acima da imagem */
.hero-card * {
    position: relative;
    z-index: 1;
}

@keyframes fadeUp {
    from {
        opacity: 0;
        transform: translateY(18px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.badge {
    display: inline-block;
    border: 1px solid rgba(255,255,255,.3);
    padding: 4px 14px;
    border-radius: 30px;
    font-size: 11px;
    text-transform: uppercase;
    opacity: .85;
}

.hero-card h1 {
    font-size: 24px;
    margin-top: 14px;
    font-weight: 600;
}

.hero-card p {
    margin-top: 6px;
    font-size: 14px;
    color: #cfcfcf;
}

/* ===== CANDIDATOS ===== */
.candidate-card {
    position: relative;
    display: flex;
    align-items: center;
    height: 88px;
    background: #1c1f26;
    margin-bottom: 12px;
    border-radius: 16px;
    padding: 14px;
    cursor: pointer;
    border: 1px solid rgba(255,255,255,.05);
    overflow: hidden;

    transition: all .25s ease;
    animation: fadeUp .4s ease;
}

.candidate-card:hover {
    transform: scale(1.02);
    background: #262a38;
}

.candidate-card:active {
    transform: scale(.98);
}


.candidate-card img {
    position: absolute;
    top: 0;
    left: 0;            
    width: 38%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: 16px 0 0 16px;
    opacity: .9;
}


.candidate-info {
    position: relative;
    z-index: 1;
    width: 62%;
    margin-left: auto; 
}


.candidate-info h3 {
    font-size: 16px;
}

.candidate-info p {
    font-size: 13px;
    color: #b5b5b5;
}

.candidate-card::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
        to left,
        rgba(28,31,38,1) 45%,
        rgba(28,31,38,.6) 65%,
        transparent 100%
    );
    pointer-events: none;
}

/* ===== CONFIRMA√á√ÉO ===== */
#step-confirmacao h2 {
    margin-bottom: 16px;
}

#selected-candidate-card .candidate-card {
    background: #242834;
    cursor: default;
}

/* ===== CAPTCHA ===== */

.captcha-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
    padding: 24px;
    background: rgba(0,0,0,.55);
    border-radius: 22px;
    backdrop-filter: blur(12px);
}

/* ===== BOT√ïES ===== */
button {
    background: linear-gradient(135deg, #ff005d, #6a00ff);
    border: none;
    color: #fff;
    padding: 14px;
    border-radius: 30px;
    font-size: 15px;
    cursor: pointer;
    transition: transform .2s ease, box-shadow .2s ease;
    box-shadow: 0 8px 20px rgba(0,0,0,.35);
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(0,0,0,.5);
}

button:active {
    transform: scale(.97);
}

.btn-back {
    background: transparent;
    border: 1px solid rgba(255,255,255,.25);
    margin-top: 10px;
}

/* ===== SUCESSO ===== */
#step-sucesso {
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 140px);
}

#step-sucesso.active {
    display: flex;
}


.success-card {
    width: 100%;
    max-width: 360px;
    background:
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.85)),
        url("https://i.ibb.co/h14c6kWP/Chat-GPT-Image-24-de-dez-de-2025-12-57-49.png");
    background-size: cover;
    background-position: center;
    border-radius: 26px;
    padding: 36px 24px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,.6);
    animation: fadeUp .6s ease;
}

.success-icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border: 3px solid #5CFF7A;
    color: #5CFF7A;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    margin: 0 auto 18px;
}

.success-card h2 {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 26px;
}

.btn-again {
    background: #fff;
    color: #000;
    border-radius: 999px;
    padding: 14px 26px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: transform .2s ease;
}

.btn-again:hover {
    transform: scale(1.04);
}

@keyframes pulse {
    0% { box-shadow: 0 0 20px rgba(46,204,113,.5); }
    50% { box-shadow: 0 0 45px rgba(46,204,113,.9); }
    100% { box-shadow: 0 0 20px rgba(46,204,113,.5); }
}

/* ===== FOOTER ===== */
footer {
    margin-top: auto;
    text-align: center;
    padding: 26px 0;
    font-size: 13px;
    color: #9a9a9a;
}

footer strong {
    color: #fff;
}

.btn-logout {
    background: none;
    border: none;
    color: #9a9a9a;
    text-decoration: underline;
    cursor: pointer;
}

.spacer {
    width: 100%;
    height: 24px;   
    pointer-events: none;
    user-select: none;
}

.cronometro-box {
    margin-top: auto;
    text-align: center;
    padding: 14px 0 6px;
    font-size: 13px;
    opacity: .85;
}

.cronometro-box strong {
    display: block;
    margin-top: 4px;
    font-size: 22px;
    font-weight: 700;
    letter-spacing: 1px;
}

</style>

<body>
    <div class="container">
        <section id="step-vota√ß√£o" class="step active">
            <div class="hero-card">
                <span class="badge">Vota√ß√£o</span>
                <h1>Quem deve ser ELIMINADO?</h1>
                <p>Voc√™ pode votar quantas vezes quiser.</p>
            </div>

            <div class="candidate-list" id="candidate-list">
                </div>
                
<div class="cronometro-box">
    <span>Encerramento em</span>
<strong class="cronometro">--:--</strong>
</div>

        </section>

        <section id="step-confirmacao" class="step">
              <div class="hero-card">
              <span class="badge">Vota√ß√£o</span>
              <h1>Op√ß√£o selecionada</h1>
              <p>Passe pelo catcha para enviar o seu voto</p>
            </div>
            <h2>Confirme seu voto</h2>
            <div id="selected-candidate-card"></div>
            
            <div class="captcha-container">
                <div class="g-recaptcha" data-sitekey="6Lev1DUsAAAAANzB2nhPDsKVzXZP0daxuDMCil1a" data-callback="onCaptchaSuccess" data-theme="dark"></div>
            </div>

            <button class="btn-back" onclick="changeStep('vota√ß√£o')">
                <span class="icon">‚Ü∫</span> Alterar voto
            </button>
            
            <div class="cronometro-box">
    <span>Encerramento em</span>
<strong class="cronometro">--:--</strong>
</div>
        </section>

<section id="step-sucesso" class="step">
    <div class="success-card">
        <div class="success-icon">‚úì</div>
        <h2>Voto computado com sucesso!</h2>
        <button class="btn-again" onclick="resetVotacao()">Votar novamente</button>
    </div>
    </div>

<div class="cronometro-box">
    <span>Encerramento em</span>
<strong class="cronometro">--:--</strong>
</div>
</section>
    </div>


</body>
</html>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://rvizztgogtepktmnfdhc.supabase.co",
  "sb_publishable_5vd5eUluXqj2Wq0xTaWwdA_QUpGP9kP"
);

/* üî• CONTROLE TOTAL */
const VERSAO_VOTACAO = 1;        // MUDE PARA RESETAR
const DURACAO_VOTACAO = 5 * 60; // 5 minutos

const timers = document.querySelectorAll(".cronometro");
let encerramentoServidor = 0;

async function sincronizar() {
  const { data } = await supabase
    .from("controle_votacao")
    .select("versao, encerramento")
    .eq("id", 1)
    .single();

  if (data.versao < VERSAO_VOTACAO) {
    const novoEncerramento = new Date(
      Date.now() + DURACAO_VOTACAO * 1000
    ).toISOString();

    await supabase
      .from("controle_votacao")
      .update({
        versao: VERSAO_VOTACAO,
        encerramento: novoEncerramento
      })
      .eq("id", 1);

    encerramentoServidor = new Date(novoEncerramento).getTime();
  } else {
    encerramentoServidor = new Date(data.encerramento).getTime();
  }

  iniciar();
}

function iniciar() {
  setInterval(() => {
    const restante = Math.floor((encerramentoServidor - Date.now()) / 1000);

    if (restante <= 0) {
      location.href = "fechada.html";
      return;
    }

    const min = Math.floor(restante / 60);
    const sec = restante % 60;

    timers.forEach(el =>
      el.textContent = `${min}:${sec.toString().padStart(2, "0")}`
    );
  }, 1000);
}

sincronizar();

if (!data.encerramento) {
  const novoEncerramento = new Date(
    Date.now() + DURACAO_VOTACAO * 1000
  ).toISOString();

  await supabase
    .from("controle_votacao")
    .update({ encerramento: novoEncerramento })
    .eq("id", 1);

  encerramentoServidor = new Date(novoEncerramento).getTime();
} else {
  encerramentoServidor = new Date(data.encerramento).getTime();
}

</script>

<script>
const _supabase = window.supabase.createClient(
  'https://rvizztgogtepktmnfdhc.supabase.co',
  'sb_publishable_5vd5eUluXqj2Wq0xTaWwdA_QUpGP9kP'
);


const candidatos = [
    { id: 1, nome: 'Bell √âter', time: 'Time Duda', foto: 'https://i.ibb.co/G3ppwjkj/Gean.jpg' },
    { id: 2, nome: 'Jamah', time: 'Time P√©ricles', foto: 'https://i.ibb.co/XZmgWgL1/Felipe.jpg' },
    { id: 3, nome: 'Thiago Garcia', time: 'Time Mumu', foto: 'https://i.ibb.co/YBP4Hs44/Neto.jpg' },
    { id: 4, nome: 'Jade Salles', time: 'Time M&K', foto: 'https://i.ibb.co/KxdRJJ8h/Sam.jpg' }
];

let candidatoSelecionado = null;

// Renderizar candidatos
function renderCandidates() {
    const list = document.getElementById('candidate-list');
    list.innerHTML = candidatos.map(c => `
        <div class="candidate-card" onclick="selectCandidate(${c.id})">
            <img src="${c.foto}" alt="${c.nome}">
            <div class="candidate-info">
                <h3>${c.nome}</h3>
                <p>${c.time}</p>
            </div>
        </div>
    `).join('');
}

function selectCandidate(id) {
    candidatoSelecionado = candidatos.find(c => c.id === id);
    document.getElementById('selected-candidate-card').innerHTML = `
        <div class="candidate-card">
            <img src="${candidatoSelecionado.foto}">
            <div class="candidate-info">
                <h3>${candidatoSelecionado.nome}</h3>
                <p>${candidatoSelecionado.time}</p>
            </div>
        </div>
    `;
    changeStep('confirmacao');
}

function changeStep(stepId) {
    const steps = document.querySelectorAll('.step');
    steps.forEach(s => {
        s.classList.remove('active');
    });

    const target = document.getElementById(`step-${stepId}`);
    target.classList.add('active');
    target.scrollIntoView({ behavior: 'smooth' });
}

// Callback do Captcha (executa quando o usu√°rio clica no "N√£o sou um rob√¥")
async function onCaptchaSuccess() {
    if (!candidatoSelecionado) return;

    // Enviar para o Supabase
    const { data, error } = await _supabase
        .from('votos')
        .insert([{ candidato_id: candidatoSelecionado.id }]);

    if (error) {
        alert("Erro ao votar: " + error.message);
    } else {
        changeStep('sucesso');
    }
}

function resetVotacao() {
    candidatoSelecionado = null;
    grecaptcha.reset(); // Reseta o captcha para novo voto
    changeStep('vota√ß√£o');
}

// Inicializar
renderCandidates();
</script>
