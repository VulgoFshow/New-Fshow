<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Sims - Votação</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <link rel="icon" href="https://i.ibb.co/0Vv5RSLg/Logo-Fshow2.png" type="image/png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon.png">
<link rel="icon" type="image/png" sizes="192x192" href="/favicon.png">

<link rel="apple-touch-icon" sizes="57x57" href="/favicon.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicon.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicon.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicon.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicon.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicon.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicon.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">

<link rel="icon" type="image/png" sizes="192x192" href="/favicon.png">
<link rel="icon" type="image/png" sizes="512x512" href="/favicon.png">

<meta name="theme-color" content="#8A2BE2">
<meta name="msapplication-TileColor" content="#FF8C00">
<meta name="msapplication-TileImage" content="/favicon.png">

<link rel="icon" type="image/png" sizes="192x192" href="/favicon.png">
<link rel="icon" type="image/png" sizes="512x512" href="/favicon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">
<link rel="mask-icon" href="/favicon.png" color="#ff8c00">
<link rel="manifest" href="/favicon.png">
<meta name="msapplication-TileColor" content="#ff8c00">
<meta name="msapplication-TileImage" content="/favicon.png">
<meta name="theme-color" content="#8a2be2">
</head>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Roboto, Arial, sans-serif;
}

html {
    scroll-behavior: smooth;
}

body {
    background: radial-gradient(circle at top, #1a1a1a 0%, #000 65%);
    color: #fff;
}

.container {
    max-width: 430px;
    margin: 0 auto;
    padding: 16px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;

    border: 2px solid rgba(255,255,255,.25);
    border-radius: 24px;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
}

/* ===== STEPS ===== */
.step {
    display: none;
    opacity: 0;
    transform: translateY(20px);
    animation: stepIn .45s ease forwards;
}

.step.active {
    display: block;
}

@keyframes stepIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== HEADER ===== */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 0;
}

.logo {
    height: 34px;
}

.menu-icon span {
    display: block;
    width: 22px;
    height: 2px;
    background: #fff;
    margin: 4px 0;
    opacity: .9;
}

/* ===== HERO ===== */
.hero-card {
    position: relative;
    padding: 22px;
    margin: -16px -16px 22px -16px;
    overflow: hidden;

    border-radius: 0;

    background-image:
        linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.85)),
        url("https://i.ibb.co/8gvrdhDw/colorsplash.png");
    background-size: cover;
    background-position: center;
}

/* Gradientes coloridos por cima da imagem */
.hero-card::after {
    content: "";
    position: absolute;
    inset: 0;
    background:
        radial-gradient(circle at top right, rgba(255,0,80,.45), transparent 60%),
        radial-gradient(circle at bottom left, rgba(120,0,255,.45), transparent 60%);
    pointer-events: none;
}

/* Conteúdo acima da imagem */
.hero-card * {
    position: relative;
    z-index: 1;
}

@keyframes fadeUp {
    from {
        opacity: 0;
        transform: translateY(18px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.badge {
    display: inline-block;
    border: 1px solid rgba(255,255,255,.3);
    padding: 4px 14px;
    border-radius: 30px;
    font-size: 11px;
    text-transform: uppercase;
    opacity: .85;
}

.hero-card h1 {
    font-size: 24px;
    margin-top: 14px;
    font-weight: 600;
}

.hero-card p {
    margin-top: 6px;
    font-size: 14px;
    color: #cfcfcf;
}

/* ===== CANDIDATOS ===== */
.candidate-card {
    position: relative;
    display: flex;
    align-items: center;
    height: 88px;
    background: #1c1f26;
    margin-bottom: 12px;
    border-radius: 16px;
    padding: 14px;
    cursor: pointer;
    border: 1px solid rgba(255,255,255,.05);
    overflow: hidden;

    transition: all .25s ease;
    animation: fadeUp .4s ease;
}

.candidate-card:hover {
    transform: scale(1.02);
    background: #262a38;
}

.candidate-card:active {
    transform: scale(.98);
}


.candidate-card img {
    position: absolute;
    top: 0;
    left: 0;            
    width: 38%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: 16px 0 0 16px;
    opacity: .9;
}


.candidate-info {
    position: relative;
    z-index: 1;
    width: 62%;
    margin-left: auto; 
}


.candidate-info h3 {
    font-size: 16px;
}

.candidate-info p {
    font-size: 13px;
    color: #b5b5b5;
}

.candidate-card::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
        to left,
        rgba(28,31,38,1) 45%,
        rgba(28,31,38,.6) 65%,
        transparent 100%
    );
    pointer-events: none;
}

/* ===== CONFIRMAÇÃO ===== */
#step-confirmacao h2 {
    margin-bottom: 16px;
}

#selected-candidate-card .candidate-card {
    background: #242834;
    cursor: default;
}

/* ===== CAPTCHA ===== */

.captcha-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
    padding: 24px;
    background: rgba(0,0,0,.55);
    border-radius: 22px;
    backdrop-filter: blur(12px);
}

/* ===== BOTÕES ===== */
button {
    background: linear-gradient(135deg, #ff005d, #6a00ff);
    border: none;
    color: #fff;
    padding: 14px;
    border-radius: 30px;
    font-size: 15px;
    cursor: pointer;
    transition: transform .2s ease, box-shadow .2s ease;
    box-shadow: 0 8px 20px rgba(0,0,0,.35);
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(0,0,0,.5);
}

button:active {
    transform: scale(.97);
}

.btn-back {
    background: transparent;
    border: 1px solid rgba(255,255,255,.25);
    margin-top: 10px;
}

/* ===== SUCESSO ===== */
#step-sucesso {
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 140px);
}

#step-sucesso.active {
    display: flex;
}


.success-card {
    width: 100%;
    max-width: 360px;
    background:
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.85)),
        url("https://i.ibb.co/h14c6kWP/Chat-GPT-Image-24-de-dez-de-2025-12-57-49.png");
    background-size: cover;
    background-position: center;
    border-radius: 26px;
    padding: 36px 24px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,.6);
    animation: fadeUp .6s ease;
}

.success-icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border: 3px solid #5CFF7A;
    color: #5CFF7A;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    margin: 0 auto 18px;
}

.success-card h2 {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 26px;
}

.btn-again {
    background: #fff;
    color: #000;
    border-radius: 999px;
    padding: 14px 26px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: transform .2s ease;
}

.btn-again:hover {
    transform: scale(1.04);
}

@keyframes pulse {
    0% { box-shadow: 0 0 20px rgba(46,204,113,.5); }
    50% { box-shadow: 0 0 45px rgba(46,204,113,.9); }
    100% { box-shadow: 0 0 20px rgba(46,204,113,.5); }
}

/* ===== FOOTER ===== */
footer {
    margin-top: auto;
    text-align: center;
    padding: 26px 0;
    font-size: 13px;
    color: #9a9a9a;
}

footer strong {
    color: #fff;
}

.btn-logout {
    background: none;
    border: none;
    color: #9a9a9a;
    text-decoration: underline;
    cursor: pointer;
}

.spacer {
    width: 100%;
    height: 24px;   
    pointer-events: none;
    user-select: none;
}

.cronometro-box {
    margin-top: auto;
    text-align: center;
    padding: 14px 0 6px;
    font-size: 13px;
    opacity: .85;
}

.cronometro-box strong {
    display: block;
    margin-top: 4px;
    font-size: 22px;
    font-weight: 700;
    letter-spacing: 1px;
}


@media (min-width: 768px) {
    .hero-card {
        border-top-left-radius: 24px;
        border-top-right-radius: 24px;
    }
}


</style>

<body>
    <div class="container">
        <section id="step-votação" class="step active">
            <div class="hero-card">
                <span class="badge">Votação</span>
                <h1>Quem deve ser ELIMINADO?</h1>
                <p>Você pode votar quantas vezes quiser.</p>
            </div>

            <div class="candidate-list" id="candidate-list">
                </div>

        </section>

        <section id="step-confirmacao" class="step">
              <div class="hero-card">
              <span class="badge">Votação</span>
              <h1>Opção selecionada</h1>
              <p>Passe pelo catcha para enviar o seu voto</p>
            </div>
            <h2>Confirme seu voto</h2>
            <div id="selected-candidate-card"></div>
            
            <div class="captcha-container">
                <div class="g-recaptcha" data-sitekey="6Lev1DUsAAAAANzB2nhPDsKVzXZP0daxuDMCil1a" data-callback="onCaptchaSuccess" data-theme="dark"></div>
            </div>

            <button class="btn-back" onclick="changeStep('votação')">
                <span class="icon">↺</span> Alterar voto
            </button>
            
        </section>

<section id="step-sucesso" class="step">
    <div class="success-card">
        <div class="success-icon">✓</div>
        <h2>Voto computado com sucesso!</h2>
        <button class="btn-again" onclick="resetVotacao()">Votar novamente</button>
    </div>
    </div>

    <!-- POPUP CAPTCHA -->
<div id="popupCaptcha" class="popup">
  <div class="captcha-box">
    <p id="captcha-instrucao"></p>
    <div id="captchaGrid" class="captcha-grid"></div>
    <button id="captchaRefresh">Recarregar</button>
    <button id="captchaConfirm" disabled>Confirmar</button>
    <div id="captchaStatus"></div>
  </div>
</div>
</section>
    </div>

</body>
</html>

<script>
/* ===================== CONFIGURAÇÃO ===================== */
const VOTACAO_ABERTA = true;
const VOTOS_POR_CAPTCHA = 1;

/* ===================== SUPABASE ===================== */
const _supabase = window.supabase.createClient(
  "https://rvizztgogtepktmnfdhc.supabase.co",
  "sb_publishable_5vd5eUluXqj2Wq0xTaWwdA_QUpGP9kP"
);

/* ===================== CANDIDATOS ===================== */
const candidatos = [
  { id:1, nome:"Bell Éter", foto:"https://i.ibb.co/G3ppwjkj/Gean.jpg" },
  { id:2, nome:"Jamah", foto:"https://i.ibb.co/XZmgWgL1/Felipe.jpg" },
  { id:3, nome:"Thiago Garcia", foto:"https://i.ibb.co/YBP4Hs44/Neto.jpg" },
  { id:4, nome:"Jade Salles", foto:"https://i.ibb.co/KxdRJJ8h/Sam.jpg" }
];

let candidatoSelecionado = null;
let pendingVote = null;
let captchaAberto = false;

/* ===================== RENDER ===================== */
function renderCandidates() {
  const list = document.getElementById("candidate-list");
  list.innerHTML = candidatos.map(c => `
    <div class="candidate-card" onclick="selectCandidate(${c.id})">
      <img src="${c.foto}" width="60">
      <b>${c.nome}</b>
    </div>
  `).join("");
}

function selectCandidate(id) {
  candidatoSelecionado = candidatos.find(c => c.id === id);
}

/* ===================== CONTROLE LOCAL ===================== */
function hashTag(v) {
  let h = 0; const s = v + "CPTX2025";
  for (let i=0;i<s.length;i++) h=(h<<5)-h+s.charCodeAt(i);
  return h|0;
}

function setVotosRestantes(n){
  localStorage.setItem("vr", n);
  localStorage.setItem("vt", hashTag(String(n)));
}
function getVotosRestantes(){
  const v = localStorage.getItem("vr");
  return hashTag(v) == localStorage.getItem("vt") ? +v : 0;
}

/* ===================== CAPTCHA ===================== */
  const prompts = [
    {
      label: "Clique nas imagens contendo algo que pode se locomover",
      correctTag: "202",
      images: [
        { src: "https://i.ibb.co/cSMQWgx4/car1.png", tag: "202" },
        { src: "https://i.ibb.co/d0CCf03S/moto1.png", tag: "202" },
        { src: "https://i.ibb.co/tp8Mxrd9/car3.png", tag: "202" },
        { src: "https://i.ibb.co/vtwFRhB/moto2.png", tag: "202" },
        { src: "https://i.ibb.co/kVQVS7yD/car4.png", tag: "202" },
        { src: "https://i.ibb.co/1f3FBvb9/montanha2.png", tag: "404" },
        { src: "https://i.ibb.co/8LztFZt4/montanha.png", tag: "404" },
        { src: "https://i.ibb.co/XZwwyFZq/arvore.png", tag: "404" },
        { src: "https://i.ibb.co/ZDG821x/arvore2.png", tag: "404" },
        { src: "https://thumbs.dreamstime.com/b/rocha-ou-pedra-grande-na-montanha-118007979.jpg", tag: "404" }
      ]
    },
    {
      label: "Clique nas imagens contendo um animal",
      correctTag: "706",
      images: [
        { src: "https://i.ibb.co/PZPW0gzR/elefante.jpg", tag: "706" },
        { src: "https://i.ibb.co/zHZ6BhsR/cavalo.jpg", tag: "706" },
        { src: "https://i.ibb.co/Nw9HKGp/leao.jpg", tag: "706" },
        { src: "https://i.ibb.co/VcBzNJsw/rino.jpg", tag: "706" },
        { src: "https://i.ibb.co/0jr3fwBd/girafa.jpg", tag: "706" },
        { src: "https://i.ibb.co/WNh2CsLC/torta.png", tag: "1412" },
        { src: "https://i.ibb.co/BHvGC4Cr/cookie.png", tag: "1412" },
        { src: "https://i.ibb.co/35sfVQvY/donuts.png", tag: "1412" },
        { src: "https://i.ibb.co/rRT6hz08/bolo.png", tag: "1412" }
      ]
    }
  ];

let captchaAtual = null;
const grid = document.getElementById("captchaGrid");
const instrucao = document.getElementById("captcha-instrucao");
const statusEl = document.getElementById("captchaStatus");
const btnConfirm = document.getElementById("captchaConfirm");

function abrirCaptcha(){
  captchaAberto = true;
  gerarCaptcha();
  document.getElementById("popupCaptcha").classList.add("active");
}

function fecharCaptcha(){
  captchaAberto = false;
  document.getElementById("popupCaptcha").classList.remove("active");
}

function gerarCaptcha(){
  grid.innerHTML="";
  statusEl.textContent="";
  btnConfirm.disabled=true;
  captchaAtual = prompts[0];
  instrucao.textContent = captchaAtual.label;

  captchaAtual.images.forEach(img=>{
    const el=document.createElement("img");
    el.src=img.src;
    el.dataset.tag=img.tag;
    el.className="captcha-img";
    el.onclick=()=>{
      el.classList.toggle("selected");
      btnConfirm.disabled = !document.querySelector(".captcha-img.selected");
    };
    grid.appendChild(el);
  });
}

btnConfirm.onclick = ()=>{
  let ok=true;
  document.querySelectorAll(".captcha-img").forEach(img=>{
    const certo = img.dataset.tag === captchaAtual.correct;
    if (certo !== img.classList.contains("selected")) ok=false;
  });

  if(!ok){
    statusEl.textContent="Incorreto";
    return gerarCaptcha();
  }

  setVotosRestantes(VOTOS_POR_CAPTCHA);
  document.getElementById("botaoVotar").disabled=false;
  fecharCaptcha();

  if(pendingVote){
    pendingVote=null;
    submitVote();
  }
};

/* ===================== VOTO ===================== */
async function submitVote(){
  if(!VOTACAO_ABERTA) return alert("Votação encerrada");
  if(!candidatoSelecionado) return alert("Selecione alguém");

  if(getVotosRestantes()<=0){
    pendingVote=true;
    abrirCaptcha();
    return;
  }

  setVotosRestantes(getVotosRestantes()-1);

  const { error } = await _supabase
    .from("votos")
    .insert([{ candidato_id:candidatoSelecionado.id }]);

  if(error) return alert(error.message);
  document.getElementById("step-votacao").style.display="none";
  document.getElementById("step-sucesso").style.display="block";
}

/* ===================== EVENTOS ===================== */
document.getElementById("botaoCaptcha").onclick = abrirCaptcha;
document.getElementById("botaoVotar").onclick = submitVote;
document.getElementById("captchaRefresh").onclick = gerarCaptcha;

/* INIT */
renderCandidates();
</script>
