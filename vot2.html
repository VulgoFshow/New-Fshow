<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Fshow/Votação</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>

    :root {
      --bg: #121212;
      --card-bg: #2b2b2b;
      --selected-bg: #3c3c3c;
      --border-radius: 8px;
      --accent: #00b7b0;
      --text: #fff;
      --muted: #bdbdbd;
      --panel-bg: #2b2b2b;
      --panel-border: rgba(255,255,255,0.06);
      
    }body {
  background: transparent !important; /* fundo totalmente transparente */
  font-family: Arial, sans-serif;
  color: var(--text);
  margin: 0;
  padding: 0;
}

.container {
  max-width: 400px;
  margin: 0 auto;
  padding: 20px 15px;
}

color:var(--text);margin:0;padding:0}

    h1{font-size:20px;font-weight:700;margin-bottom:20px;text-align:left}
    .option{display:flex;align-items:stretch;background:var(--card-bg);border-radius:var(--border-radius);margin-bottom:12px;overflow:hidden;border:1px solid #fff;cursor:pointer;transition:.2s}
    .option img{width:150px;height:auto;object-fit:cover;flex-shrink:0}
    .option-content{display:flex;align-items:center;padding:0 12px;width:100%;font-size:18px;font-weight:500;position:relative}
    .option-content input[type="radio"]{appearance:none;-webkit-appearance:none;width:20px;height:20px;border:2px solid var(--muted);border-radius:50%;margin-right:8px;cursor:pointer;position:relative}
    .option-content input[type="radio"]:checked{border-color:var(--accent)}
    .option-content input[type="radio"]:checked::before{content:"";position:absolute;width:10px;height:10px;top:3px;left:3px;border-radius:50%;background:var(--accent)}
    button{width:100%;padding:14px;font-size:16px;border:none;border-radius:var(--border-radius);margin-top:15px;cursor:pointer;background:#444;color:var(--muted);font-weight:bold;transition:.3s}
    button.active{background:var(--accent);color:#fff}
    button:disabled{opacity:.6;cursor:not-allowed}
    .notice{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}

    /* popup & confirmação (mantidos) */
    .popup{display:none;position:fixed;z-index:1500;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.85);align-items:center;justify-content:center;padding:20px;overflow-y:auto}
    .popup.active{display:flex}
    .captcha-box{background:#222;padding:20px 30px;border-radius:10px;width:340px;max-width:100%;text-align:center;color:#eee}
    .captcha-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:15px}
    .captcha-img{width:100%;aspect-ratio:1/1;object-fit:cover;border:2px solid transparent;cursor:pointer;border-radius:6px}
    .captcha-img.selected{border-color:#00aaff;box-shadow:0 0 8px #00aaffcc}
    .captcha-footer{display:flex;gap:10px;justify-content:center}
    .captcha-btn{background:#00aaff;color:#111;border:none;padding:9px 18px;font-size:15px;font-weight:600;border-radius:6px;cursor:pointer;flex:1;max-width:140px}
    .captcha-btn:disabled{background:#004466;cursor:not-allowed}
    #confirmTela{display:none;flex-direction:column;align-items:center;justify-content:center;padding:20px;text-align:center;background:var(--bg);min-height:85vh}
    .confirm-card{background:var(--panel-bg);border:1px solid var(--panel-border);border-radius:12px;padding:20px;max-width:380px;width:100%}
    #fotoConfirm{width:100%;border-radius:10px;margin-bottom:12px;border:1px solid #fff}
    #nomeConfirm{background:#222;color:#fff;font-size:18px;font-weight:700;padding:10px;border-radius:6px;margin-bottom:18px;border:1px solid #fff}
    .success-msg{display:flex;align-items:center;justify-content:center;font-size:14px;color:#fff;background:rgba(0,255,100,.15);border:1px solid rgba(0,255,100,.4);border-radius:6px;padding:10px;margin-bottom:18px}
    .success-msg::before{content:"✔";color:#00ff6a;margin-right:6px}
    .voltar{background:var(--accent);color:#fff}
    
    #botaoCaptcha {
      display: flex;               
      align-items: center;         
      justify-content: flex-start; 
      background: #222;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 0 15px;
      cursor: pointer;
      user-select: none;
      height: 70px;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.6);
      transition: border-color 0.3s, box-shadow 0.3s;
      color: #ccc;
      font-size: 14px;
      font-weight: 400;
      margin: 20px auto 0;       
      max-width: 320px;          
      width: 320px;              
      gap: 12px;
    }

    .recaptcha-checkbox {
      flex-shrink: 0;
      width: 30px;
      height: 30px;
      background: #111;
      border: 2px solid #444;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #botaoCaptcha[aria-pressed="true"] .recaptcha-checkbox {
      background-color: #00aaff;
      border-color: #00aaff;
    }

    .checkmark {
      width: 18px;
      height: 18px;
      display: none;
      stroke: white;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    #botaoCaptcha[aria-pressed="true"] .checkmark {
      display: block;
    }

    .recaptcha-label {
      user-select: none;
      line-height: 1;
      flex-grow: 1;              
    }

    .recaptcha-icon {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: contain;
      filter: brightness(0.7);
      flex-shrink: 0;
    }

  </style>
</head>
<body>
  <div id="votoTela" class="container">
    <h1>Quem deve ser ELIMINADO?</h1>

    <label class="option">
      <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bkoyuh.jpg?raw=true" alt="Koyuh">
      <div class="option-content">
        <input type="radio" name="vote" value="Koyuh"> Koyuh
      </div>
    </label>

    <label class="option">
      <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bmikael.jpg?raw=true" alt="Mikael">
      <div class="option-content">
        <input type="radio" name="vote" value="Mikael"> Mikael
      </div>
    </label>

    <label class="option">
      <img src="https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/btety.jpg?raw=true" alt="Tety">
      <div class="option-content">
        <input type="radio" name="vote" value="Tety"> Tety
      </div>
    </label>

    <button id="botaoCaptcha" aria-pressed="false" type="button" aria-label="Não sou um robô">
      <span class="recaptcha-checkbox" aria-hidden="true">
        <svg class="checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M4 12l6 6 10-10"/></svg>
      </span>
      <span class="recaptcha-label">Não sou um robô</span>
      <img class="recaptcha-icon" src="https://i.imgur.com/orZDpuE.png" alt="Logo personalizada" style="width:40px;height:40px;border-radius:4px"/>
    </button>

    <!-- removi onclick inline daqui -->
    <button id="botaoVotar" disabled>Votar</button>

    <div class="notice">São válidos apenas os votos feitos em território nacional.</div>
  </div>

  <script async="async" data-cfasync="false" src="//pl27399086.revenuecpmgate.com/1faff871cdf0e9772e4c2ca3e13e0bee/invoke.js"></script>
<div id="container-1faff871cdf0e9772e4c2ca3e13e0bee"></div>

  <div id="popupCaptcha" class="popup">
    <div class="captcha-box">
      <h3 id="captcha-instruction">Carregando desafio...</h3>
      <div id="captcha-grid" class="captcha-grid"></div>
      <div class="captcha-footer">
        <button id="refresh-btn" class="captcha-btn">↻ Novo</button>
        <button id="verify-btn" class="captcha-btn" disabled>Verificar</button>
      </div>
      <div id="captcha-status" class="captcha-status"></div>
    </div>
  </div>

  <div id="confirmTela">
    <div class="confirm-card">
      <img id="fotoConfirm" src="" alt="Foto do participante"/>
      <p id="nomeConfirm"></p>
      <div class="success-msg">Voto computado com sucesso!</div>
      <button class="voltar" onclick="window.location.href='https://fshow.site/vot2.html'">
  VOTAR NOVAMENTE
</button>
      <div class="notice-confirm">São válidos apenas os votos feitos em território nacional.</div>
      <script async="async" data-cfasync="false" src="//pl27399086.revenuecpmgate.com/1faff871cdf0e9772e4c2ca3e13e0bee/invoke.js"></script>
<div id="container-1faff871cdf0e9772e4c2ca3e13e0bee"></div>
    </div>
  </div>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js';

const supabase = createClient(
  'https://vchvvvvzulrkovjmiokg.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjaHZ2dnZ6dWxya292am1pb2tnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NzYwMDIsImV4cCI6MjA3NDA1MjAwMn0.vHgI_JDNKDECR8H1wVC3LwGeMux8gAKkoeCmPSPuSA4'
);

const votacaoAtiva = true;
if (!votacaoAtiva) {
  window.location.href = "Votação Encerrada.html";
}

// ===== CONTADOR DE VOTOS LOCAL =====
const VOTOS_POR_CAPTCHA = 5;
function getVotosRestantes() {
  return parseInt(localStorage.getItem("votosRestantes") || VOTOS_POR_CAPTCHA);
}
function setVotosRestantes(n) {
  localStorage.setItem("votosRestantes", n);
}

// ===== ELEMENTOS =====
const votoTela = document.getElementById("votoTela");
const confirmTela = document.getElementById("confirmTela");
const nomeConfirm = document.getElementById("nomeConfirm");
const fotoConfirm = document.getElementById("fotoConfirm");

const botaoCaptcha = document.getElementById("botaoCaptcha");
const botaoVotar = document.getElementById("botaoVotar");

const popupCaptcha = document.getElementById("popupCaptcha");
const captchaGrid = document.getElementById("captcha-grid");
const captchaInstruction = document.getElementById("captcha-instruction");
const verifyBtn = document.getElementById("verify-btn");
const refreshBtn = document.getElementById("refresh-btn");
const statusEl = document.getElementById("captcha-status");

// ===== CAPTCHA ====
  const prompts = [
      {
        label: "Clique nas imagens contendo um mamífero",
        correctTag: "mamifero",
        images: [
          { src: "https://media.istockphoto.com/id/1589824836/pt/foto/cute-brown-dog-that-smiles-isolated-background.jpg?s=612x612&w=0&k=20&c=6XY-uqPQZ3XkDHUJGk5oJJ0wv7Ez3Rt4dxEV0Bao8bI=", tag: "mamifero" }, //Cachorro
          { src: "https://media.istockphoto.com/id/1164946759/pt/foto/cute-grey-cat.jpg?s=612x612&w=0&k=20&c=shwthP3leH6C3A8tKrrFsjUSUXr7UlynbEqweinNBa8=", tag: "mamifero" }, //Gato
          { src: "https://media.istockphoto.com/id/177228186/pt/foto/jovem-capivara.jpg?s=612x612&w=0&k=20&c=HIaHC5JhfE3zobczCLIEY6bdy2NdOLq0sskZkuXsM9w=", tag: "mamifero" }, //Capivara
          { src: "https://media.istockphoto.com/id/514622028/pt/foto/pouco-guaxinim-em-%C3%A1rvore.jpg?s=612x612&w=0&k=20&c=QFycBBdmOcjYxtRh4rP20QmBYyynMk6CuduLHpcidFw=", tag: "mamifero" }, //Guaxinim
          { src: "https://media.istockphoto.com/id/1588317860/pt/foto/three-domestic-ducks-walk-along-a-green-lawn-next-to-a-pond.jpg?s=612x612&w=0&k=20&c=3QOjjJDeo0gRB52A_Pgtj3SF6WiD5LbLvo8311MKv6Q=", tag: "ave" }, //Pato
          { src: "https://media.istockphoto.com/id/508496270/pt/foto/flamingo-chileno.jpg?s=612x612&w=0&k=20&c=xEiq9i8dm48y4_Q5BIiW-7sUx2Qxbp7dtbRUn-47a0U=", tag: "ave" }, //Flamingo
          { src: "https://media.istockphoto.com/id/533995902/pt/foto/pinguim-papu-andar-na-neve-na-ant%C3%A1rctida.jpg?s=612x612&w=0&k=20&c=1-B5YRTVdsbX-B2bQB6ZEpbgxG1vUx2rJOXfq8FimL4=", tag: "ave" }, //Pinguim
          { src: "https://media.istockphoto.com/id/166006960/pt/foto/lado-do-passageiro-avi%C3%A3o-a-jato-f%C3%A1cil-de-cortar.jpg?s=612x612&w=0&k=20&c=b58Lh4rrG-YkDPrOgg2r4yvfhaFf_vzzncTeGzZirSM=", tag: "outro" }, //Avião
          { src: "https://media.istockphoto.com/id/485462644/pt/foto/helic%C3%B3ptero-em-v%C3%B4o-isolado-contra-branco.jpg?s=612x612&w=0&k=20&c=tjUUsm7JQ4kZ3RUr2v2HQP2v1J4qkw5y6Jd3NeJxwG8=", tag: "outro" } //Helicóptero 
        ]
      },
      {
        label: "Clique nas imagens contendo uma ave",
        correctTag: "ave",
        images: [
          { src: "https://media.istockphoto.com/id/464988959/pt/foto/pato-real-com-tra%C3%A7ado-de-recorte.jpg?s=612x612&w=0&k=20&c=SUhSeo67zEVs8bgUm0K-OrMDD4iQ5s75CxaOG4gBI1Y=", tag: "ave" }, //Pato
          { src: "https://media.istockphoto.com/id/1716227735/pt/foto/beautiful-white-domestic-goose.jpg?s=612x612&w=0&k=20&c=vUNR9WIh00uE5wYRJJpxR0DyVqXi5kC4ZJ-5OeBhdIM=", tag: "ave" }, //Ganso
          { src: "https://media.istockphoto.com/id/178625595/pt/foto/spheniscus-demersus-pinguim-africano-isolado-no-branco.jpg?s=612x612&w=0&k=20&c=Kv8Vfj3MbeoyiHtCseaPivn6FbxjEAFf4h-TDqrUngo=", tag: "ave" }, //Pinguim
          { src: "https://media.istockphoto.com/id/1512660779/pt/foto/close-up-giant-panda-in-republic-of-korea.jpg?s=612x612&w=0&k=20&c=cts2W9bJ7Ru7H3ncxhSqqtVYAgvuZsT1gdVgwS5Rbz0=", tag: "mamifero" }, //Panda
          { src: "https://media.istockphoto.com/id/1551607933/pt/foto/golden-retriever-dog-doing-trick.jpg?s=612x612&w=0&k=20&c=ERFmdd13iFS2hdG7Rof27T1YnSxwENsJM0ZrB57yUdk=", tag: "mamifero" }, //Cachorro
          { src: "https://media.istockphoto.com/id/1361956153/pt/foto/black-cat-sticking-out-tongue-funny-portrait.jpg?s=612x612&w=0&k=20&c=3dOtmpKZFzQeGbLTYpOWypzxDISUJWZa5-i4K653iKM=", tag: "mamifero" }, //Gato
          { src: "https://media.istockphoto.com/id/1408679386/pt/foto/capybara.jpg?s=612x612&w=0&k=20&c=rIsVTCUlZCeGF0Npz8guQLwnBquLaobfFC4Q39LcnWo=", tag: "mamifero" }, //Capivara
          { src: "https://media.istockphoto.com/id/1047163322/pt/foto/racoon-in-the-trash.jpg?s=612x612&w=0&k=20&c=c2TZ9ajlaKFBmvTd_TARVdNakiNkUQ2FEuL-mN4zSSY=", tag: "mamifero" }, //Guaxinim
          { src: "https://media.istockphoto.com/id/157430678/pt/foto/tr%C3%AAs-batatas.jpg?s=612x612&w=0&k=20&c=BoUCWwC1mWkz2JzT8K0RLaJSYfRPEWWPRSMXL36pI9Q=", tag: "outro" } //Avião
        ]
      }
    ];

function shuffle(array){ 
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  } 
  return array;
}

function generateCaptcha(){
  captchaGrid.innerHTML = "";
  statusEl.textContent = "";
  verifyBtn.disabled = true;

  const prompt = prompts[Math.floor(Math.random()*prompts.length)];
  const correctImages = prompt.images.filter(img=>img.tag===prompt.correctTag);
  const wrongImages = prompt.images.filter(img=>img.tag!==prompt.correctTag);

  const correctCount = Math.floor(Math.random()*3)+2;
  const selectedCorrect = shuffle(correctImages).slice(0,correctCount);
  const selectedWrong = shuffle(wrongImages).slice(0,9-correctCount);

  const allImages = shuffle([...selectedCorrect,...selectedWrong]);
  captchaInstruction.textContent = prompt.label;

  allImages.forEach(img=>{
    const imgEl = document.createElement("img");
    imgEl.src = img.src;
    imgEl.className = "captcha-img";
    imgEl.dataset.correct = img.tag === prompt.correctTag ? "true" : "false";
    imgEl.addEventListener("click", ()=>{
      imgEl.classList.toggle("selected");
      verifyBtn.disabled = !document.querySelector(".captcha-img.selected");
      statusEl.textContent = "";
    });
    captchaGrid.appendChild(imgEl);
  });
}

function abrirCaptcha(){
  generateCaptcha();
  popupCaptcha.classList.add("active");
  botaoCaptcha.setAttribute("aria-pressed","false");
  botaoVotar.disabled = true;
  statusEl.textContent = "";
}

function fecharCaptcha(){ popupCaptcha.classList.remove("active") }

botaoCaptcha.addEventListener("click", ()=>{
  if (botaoCaptcha.getAttribute("aria-pressed")==="true") return;
  abrirCaptcha();
});

verifyBtn.addEventListener("click", ()=>{
  let sucesso = true;
  const imgs = document.querySelectorAll(".captcha-img");
  imgs.forEach(img=>{
    const correto = img.dataset.correct === "true";
    const selecionado = img.classList.contains("selected");
    if (correto !== selecionado) sucesso = false;
  });

  if (sucesso) {
    statusEl.textContent = "✅ Você passou no CAPTCHA!";
    statusEl.style.color = "#00aaff";
    botaoCaptcha.setAttribute("aria-pressed","true");
    botaoVotar.disabled = false;
    botaoVotar.classList.add("active");
    setTimeout(()=>fecharCaptcha(), 800);
    setVotosRestantes(VOTOS_POR_CAPTCHA);
  } else {
    statusEl.textContent = "❌ Tente novamente.";
    statusEl.style.color = "#ff5555";
    setTimeout(()=>generateCaptcha(),1500);
  }
});

refreshBtn.addEventListener("click", generateCaptcha);

// ===== VOTAÇÃO =====
async function enviarVoto(){
  try {
    // ⚠️ VERIFICAÇÃO DO CAPTCHA
    if (botaoCaptcha.getAttribute("aria-pressed") !== "true") {
      alert("Você precisa passar no CAPTCHA antes de votar!");
      return;
    }

    const escolhido = document.querySelector('input[name="vote"]:checked');
    if (!escolhido) {
      alert("Selecione um participante antes de votar!");
      return;
    }

    const participante = escolhido.value;

    const foto = {
  "Koyuh": "https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bkoyuh.jpg?raw=true",
  "Mikael": "https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/bmikael.jpg?raw=true",
  "Tety": "https://github.com/VulgoFshow/New-Fshow/blob/main/bbb/btety.jpg?raw=true"
}[participante] || "";

    botaoVotar.disabled = true;
    const prevText = botaoVotar.textContent;
    botaoVotar.textContent = "Enviando...";

    const { data, error } = await supabase
      .from("paredão8")
      .insert({ participante });

    if (error) {
      console.error("Supabase error:", error);
      alert("❌ Erro ao registrar voto: " + error.message);
      botaoVotar.disabled = false;
      botaoVotar.textContent = prevText;
      return;
    }

    console.log("Voto registrado:", data);

    // controle captcha
    let restantes = getVotosRestantes() - 1;
    if (restantes <= 0) {
      botaoVotar.disabled = true;
      botaoVotar.classList.remove("active");
      botaoCaptcha.setAttribute("aria-pressed","false");
      setVotosRestantes(0); // força pedir captcha
    } else {
      setVotosRestantes(restantes);
    }

    votoTela.style.display = "none";
    confirmTela.style.display = "flex";
    nomeConfirm.textContent = participante;
    fotoConfirm.src = foto;
  } catch (err) {
    console.error("Erro enviarVoto:", err);
    alert("Erro inesperado. Veja o console do navegador.");
    botaoVotar.disabled = false;
    botaoVotar.textContent = "Votar";
  }
}

// ...todo o código que você já tem...

// Listener do botão votar

botaoVotar.addEventListener("click", enviarVoto);
</script>
</body>
</html>
